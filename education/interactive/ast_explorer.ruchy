// Interactive AST Explorer for RuchyRuchy
// Visual exploration of Abstract Syntax Trees

// AST node types for educational visualization
enum ASTNodeType {
    Program,
    Function,
    Variable,
    Expression,
    Statement,
    Literal,
    BinaryOp,
    UnaryOp,
    FunctionCall,
    Block
}

// Interactive AST node with visual information
struct InteractiveASTNode {
    node_type: ASTNodeType,
    name: str,
    value: str,
    children_count: i32,
    depth_level: i32,
    visual_color: str,
    is_expanded: bool,
    source_range: str
}

// AST exploration session
struct ASTExplorer {
    root_node: str,
    total_nodes: i32,
    current_depth: i32,
    max_depth: i32,
    selected_node: str,
    source_code: str
}

// Parsing step for tutorial
struct ParsingStep {
    step_number: i32,
    description: str,
    current_token: str,
    parser_action: str,
    ast_change: str,
    visual_highlight: str
}

// Create AST explorer
fn create_ast_explorer(source_code: str) -> ASTExplorer {
    ASTExplorer {
        root_node: "Program",
        total_nodes: 0,
        current_depth: 0,
        max_depth: 0,
        selected_node: "",
        source_code: source_code
    }
}

// Create interactive AST node
fn create_ast_node(node_type: ASTNodeType, name: str, depth: i32) -> InteractiveASTNode {
    let color = match node_type {
        ASTNodeType::Program => "darkblue",
        ASTNodeType::Function => "blue",
        ASTNodeType::Variable => "green",
        ASTNodeType::Expression => "orange",
        ASTNodeType::Statement => "purple",
        ASTNodeType::Literal => "red",
        ASTNodeType::BinaryOp => "brown",
        _ => "gray"
    };
    
    InteractiveASTNode {
        node_type: node_type,
        name: name,
        value: "",
        children_count: 0,
        depth_level: depth,
        visual_color: color,
        is_expanded: true,
        source_range: "0:0"
    }
}

// Show AST explorer introduction
fn show_ast_introduction() {
    println("ðŸŒ³ Interactive AST Explorer");
    println("===========================");
    println("");
    println("Welcome to the RuchyRuchy AST Explorer!");
    println("Learn how source code becomes an Abstract Syntax Tree.");
    println("");
    println("What you'll discover:");
    println("â€¢ How parsing creates tree structures");
    println("â€¢ Different types of AST nodes");
    println("â€¢ Relationships between nodes");
    println("â€¢ How to navigate and understand ASTs");
    println("â€¢ Visual representation of program structure");
    println("");
    println("Let's explore a simple function:");
    println("fn add(x: i32, y: i32) -> i32 { x + y }");
    println("");
}

// Demonstrate AST construction
fn demonstrate_ast_construction() {
    println("ðŸ”¨ AST Construction Demo");
    println("========================");
    
    let source = "fn add(x: i32) -> i32 { x + 1 }";
    println("Source: {}", source);
    println("");
    println("Building AST step by step...");
    println("");
    
    // Show tree structure visually
    println("Final AST Structure:");
    println("");
    println("Program [darkblue]");
    println("â””â”€â”€ Function 'add' [blue]");
    println("    â”œâ”€â”€ Parameters [purple]");
    println("    â”‚   â””â”€â”€ Parameter 'x: i32' [green]");
    println("    â”œâ”€â”€ ReturnType 'i32' [orange]");
    println("    â””â”€â”€ Body [purple]");
    println("        â””â”€â”€ Expression [orange]");
    println("            â””â”€â”€ BinaryOp '+' [brown]");
    println("                â”œâ”€â”€ Variable 'x' [green]");
    println("                â””â”€â”€ Literal '1' [red]");
    println("");
    println("âœ… AST construction complete!");
    println("Total nodes: 9");
    println("Max depth: 5 levels");
}

// Show interactive navigation
fn show_interactive_navigation() {
    println("ðŸ§­ Interactive AST Navigation");
    println("=============================");
    println("");
    println("Navigate the AST with these features:");
    println("");
    println("1. ðŸ” Node Inspection:");
    println("   â€¢ Click any node to see details");
    println("   â€¢ View source code mapping");
    println("   â€¢ See node type and properties");
    println("");
    println("2. ðŸŒ² Tree Expansion:");
    println("   â€¢ Expand/collapse subtrees");
    println("   â€¢ Focus on specific branches");
    println("   â€¢ Hide complexity when needed");
    println("");
    println("3. ðŸŽ¨ Visual Highlighting:");
    println("   â€¢ Color-coded node types");
    println("   â€¢ Source code highlighting");
    println("   â€¢ Path tracing from root to leaf");
    println("");
    println("4. ðŸ“ Depth Analysis:");
    println("   â€¢ See nesting levels");
    println("   â€¢ Understand structure complexity");
    println("   â€¢ Identify deep recursion");
}

// Advanced AST concepts
fn show_advanced_ast_concepts() {
    println("ðŸŽ“ Advanced AST Concepts");
    println("========================");
    println("");
    println("1. AST vs Parse Tree:");
    println("   â€¢ AST: Abstract, simplified structure");
    println("   â€¢ Parse Tree: Concrete, includes all syntax");
    println("   â€¢ AST removes syntactic noise");
    println("");
    println("2. Node Relationships:");
    println("   â€¢ Parent-child hierarchies");
    println("   â€¢ Sibling relationships");
    println("   â€¢ Leaf vs internal nodes");
    println("");
    println("3. AST Transformations:");
    println("   â€¢ Optimization passes");
    println("   â€¢ Code generation");
    println("   â€¢ Static analysis");
    println("");
    println("4. Visitor Pattern:");
    println("   â€¢ Traverse the entire tree");
    println("   â€¢ Apply operations to nodes");
    println("   â€¢ Collect information during traversal");
}

// Complex AST example
fn demonstrate_complex_ast() {
    println("ðŸ—ï¸  Complex AST Example");
    println("=======================");
    println("");
    println("Source: if x > 0 { return x * 2; } else { return 0; }");
    println("");
    println("Complex AST Structure:");
    println("");
    println("Program [darkblue]");
    println("â””â”€â”€ Statement [purple]");
    println("    â””â”€â”€ If [purple]");
    println("        â”œâ”€â”€ Condition [orange]");
    println("        â”‚   â””â”€â”€ BinaryOp '>' [brown]");
    println("        â”‚       â”œâ”€â”€ Variable 'x' [green]");
    println("        â”‚       â””â”€â”€ Literal '0' [red]");
    println("        â”œâ”€â”€ ThenBranch [purple]");
    println("        â”‚   â””â”€â”€ Block [purple]");
    println("        â”‚       â””â”€â”€ Return [purple]");
    println("        â”‚           â””â”€â”€ BinaryOp '*' [brown]");
    println("        â”‚               â”œâ”€â”€ Variable 'x' [green]");
    println("        â”‚               â””â”€â”€ Literal '2' [red]");
    println("        â””â”€â”€ ElseBranch [purple]");
    println("            â””â”€â”€ Block [purple]");
    println("                â””â”€â”€ Return [purple]");
    println("                    â””â”€â”€ Literal '0' [red]");
    println("");
    println("Node Count: 15");
    println("Max Depth: 7 levels");
    println("Complexity: Moderate (conditional with multiple branches)");
}

// AST analysis tools
fn show_ast_analysis_tools() {
    println("ðŸ”§ AST Analysis Tools");
    println("=====================");
    println("");
    println("1. ðŸ“Š Structure Metrics:");
    println("   â€¢ Node count by type");
    println("   â€¢ Tree depth analysis");
    println("   â€¢ Branch factor statistics");
    println("   â€¢ Complexity measurements");
    println("");
    println("2. ðŸ” Search and Query:");
    println("   â€¢ Find nodes by type");
    println("   â€¢ Search by name or value");
    println("   â€¢ Pattern matching queries");
    println("   â€¢ XPath-like expressions");
    println("");
    println("3. ðŸŽ¯ Code Quality Analysis:");
    println("   â€¢ Cyclomatic complexity");
    println("   â€¢ Nesting depth warnings");
    println("   â€¢ Dead code detection");
    println("   â€¢ Style violation detection");
    println("");
    println("4. ðŸ”„ Transformation Preview:");
    println("   â€¢ See optimization effects");
    println("   â€¢ Preview refactoring changes");
    println("   â€¢ Compare before/after trees");
}

// Interactive exercises
fn interactive_ast_exercises() {
    println("ðŸŽ® Interactive AST Exercises");
    println("============================");
    println("");
    println("Exercise 1: Basic Function");
    println("Source: fn square(n: i32) -> i32 { n * n }");
    println("Task: Identify the BinaryOp node and its operands");
    println("Answer: BinaryOp '*' has two Variable 'n' children");
    println("");
    println("Exercise 2: Nested Expressions");
    println("Source: (a + b) * (c - d)");
    println("Task: Draw the AST showing operator precedence");
    println("Hint: Multiplication is the root, additions are children");
    println("");
    println("Exercise 3: Control Flow");
    println("Source: while x < 10 { x = x + 1; }");
    println("Task: Find all the different statement types");
    println("Answer: While, Block, Assignment, BinaryOp nodes");
    println("");
    println("Exercise 4: Function Calls");
    println("Source: print(add(x, y))");
    println("Task: Identify nested function calls in the AST");
    println("Answer: FunctionCall 'print' contains FunctionCall 'add'");
}

// Demo AST exploration
fn demo_ast_exploration() {
    println("ðŸŽ¯ AST Explorer Demo");
    println("===================");
    
    let explorer = create_ast_explorer("fn test() { return 42; }");
    println("Exploring: '{}'", explorer.source_code);
    println("");
    
    // Create sample AST nodes
    let nodes = [
        create_ast_node(ASTNodeType::Program, "Program", 0),
        create_ast_node(ASTNodeType::Function, "test", 1),
        create_ast_node(ASTNodeType::Block, "Body", 2),
        create_ast_node(ASTNodeType::Statement, "Return", 3),
        create_ast_node(ASTNodeType::Literal, "42", 4)
    ];
    
    println("AST Nodes Found:");
    let mut i = 0;
    while i < nodes.len() {
        let node = &nodes[i];
        let indent = "  ".repeat(node.depth_level);
        println("{}{}. {} '{}' [{}] (depth: {})", 
                 indent,
                 i + 1,
                 format_ast_node_type(node.node_type),
                 node.name,
                 node.visual_color,
                 node.depth_level);
        i += 1;
    }
    
    println("");
    println("âœ… AST exploration completed!");
    println("Total nodes analyzed: {}", nodes.len());
}

// Format AST node type for display
fn format_ast_node_type(node_type: ASTNodeType) -> str {
    match node_type {
        ASTNodeType::Program => "PROGRAM",
        ASTNodeType::Function => "FUNCTION",
        ASTNodeType::Variable => "VARIABLE",
        ASTNodeType::Expression => "EXPRESSION",
        ASTNodeType::Statement => "STATEMENT",
        ASTNodeType::Literal => "LITERAL",
        ASTNodeType::BinaryOp => "BINARY_OP",
        ASTNodeType::UnaryOp => "UNARY_OP",
        ASTNodeType::FunctionCall => "FUNCTION_CALL",
        ASTNodeType::Block => "BLOCK"
    }
}

// Test AST explorer
fn test_ast_explorer() -> bool {
    println("ðŸ§ª Testing AST Explorer");
    
    let explorer = create_ast_explorer("test code");
    println("   âœ… Created AST explorer");
    
    let node = create_ast_node(ASTNodeType::Function, "test_fn", 1);
    println("   âœ… Created AST node");
    
    println("   âœ… All AST explorer components ready");
    
    true
}

fn main() {
    println("ðŸŒ³ RuchyRuchy Interactive AST Explorer");
    println("======================================");
    println("");
    
    // Run tests
    let success = test_ast_explorer();
    if success {
        println("   âœ… All AST explorer tests passed!");
    }
    
    println("");
    show_ast_introduction();
    
    demonstrate_ast_construction();
    
    println("");
    show_interactive_navigation();
    
    println("");
    demonstrate_complex_ast();
    
    println("");
    show_advanced_ast_concepts();
    
    println("");
    show_ast_analysis_tools();
    
    println("");
    interactive_ast_exercises();
    
    println("");
    demo_ast_exploration();
    
    println("");
    println("ðŸŽ¯ AST Explorer Features:");
    println("-------------------------");
    println("âœ… Interactive tree navigation");
    println("âœ… Visual node type identification");
    println("âœ… Source code mapping");
    println("âœ… Expandable/collapsible tree view");
    println("âœ… Node relationship analysis");
    println("âœ… Complexity measurements");
    println("âœ… Educational exercises");
    
    println("");
    println("ðŸ“š Learning Outcomes:");
    println("--------------------");
    println("â€¢ Understand AST structure and purpose");
    println("â€¢ Navigate complex parse trees");
    println("â€¢ Recognize AST node patterns");
    println("â€¢ Analyze program structure visually");
    println("â€¢ Connect source code to tree representation");
    
    println("");
    println("ðŸŽ‰ Interactive AST Explorer Complete!");
}